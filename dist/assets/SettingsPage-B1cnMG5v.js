import{r as n,u as C,z as g,j as e,a as b}from"./index-Cv_EM5B3.js";import{D as E,c as A}from"./DashboardLayout-Dgk-_yJ3.js";import{s as N}from"./setting.service-HHQ1G6XQ.js";import{R as D}from"./refresh-cw-2eDXuAuE.js";import{S as L}from"./save-BnGpkhwG.js";import"./graduation-cap-DFyTfTku.js";import"./credit-card-DXrYcg-6.js";import"./video-D6oD5f21.js";const I=()=>{const[o,d]=n.useState([]),[m,h]=n.useState(!0),[y,f]=n.useState(!1),[l,j]=n.useState("general"),{user:x}=C();n.useEffect(()=>{v()},[]);const v=async()=>{try{h(!0);const s=await N.getAllSettings();d(s.data.settings)}catch(s){g.error("Failed to fetch settings"),console.error(s)}finally{h(!1)}},p=(s,a)=>{d(r=>r.map(t=>t.key===s?{...t,value:a}:t))},S=(s,a,r)=>{d(t=>t.map(c=>{if(c.key===s)try{const u=JSON.parse(c.value);return u[a]=r,{...c,value:JSON.stringify(u)}}catch{const k={[a]:r};return{...c,value:JSON.stringify(k)}}return c}))},w=async s=>{try{f(!0);const a=o.filter(r=>r.group===s).map(r=>({key:r.key,value:r.value}));await N.updateMultipleSettings(a),g.success("Settings updated successfully")}catch{g.error("Failed to update settings")}finally{f(!1)}},i=Array.from(new Set(o.map(s=>s.group||"general"))).filter(s=>!(s==="user_permission"&&(x==null?void 0:x.role)!=="ADMIN"));return i.length===0&&!m&&i.push("general"),n.useEffect(()=>{i.length>0&&!i.includes(l)&&j(i[0])},[i]),e.jsx(E,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"System Settings"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Configure global campus management parameters"})]}),e.jsx("button",{onClick:v,className:"p-2 text-gray-500 hover:text-primary-600 transition",title:"Refresh",children:e.jsx(D,{className:`w-5 h-5 ${m?"animate-spin":""}`})})]}),m?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(b,{className:"w-12 h-12 animate-spin text-primary-600"})}):e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"flex border-b overflow-x-auto",children:i.map(s=>e.jsx("button",{onClick:()=>j(s),className:`px-6 py-4 text-sm font-medium whitespace-nowrap transition-colors ${l===s?"border-b-2 border-primary-600 text-primary-600":"text-gray-500 hover:text-gray-700"}`,children:s.split("_").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" ")},s))}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-6 max-w-4xl",children:[o.filter(s=>s.group===l||!s.group&&l==="general").map(s=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-start",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:s.key.split("_").join(" ")}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.description})]}),e.jsx("div",{className:"md:col-span-2",children:s.type==="boolean"?e.jsxs("select",{value:s.value,onChange:a=>p(s.key,a.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"true",children:"Enabled"}),e.jsx("option",{value:"false",children:"Disabled"})]}):s.type==="json"?e.jsx("div",{className:"grid grid-cols-2 gap-4 bg-gray-50 p-4 rounded-lg border border-gray-200",children:["ADMIN","USER","LECTURER","STUDENT"].map(a=>{let r=!1;try{r=!!JSON.parse(s.value)[a]}catch{}return e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",id:`${s.key}-${a}`,checked:r,onChange:t=>S(s.key,a,t.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:`${s.key}-${a}`,className:"text-sm font-medium text-gray-700",children:a.charAt(0)+a.slice(1).toLowerCase()})]},a)})}):s.type==="text"||s.type==="number"?e.jsx("input",{type:s.type,value:s.value,onChange:a=>p(s.key,a.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"}):e.jsx("textarea",{value:s.value,onChange:a=>p(s.key,a.target.value),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})})]},s.id)),o.filter(s=>s.group===l||!s.group&&l==="general").length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(A,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No settings found in this group."})]}),e.jsx("div",{className:"pt-6 border-t flex justify-end",children:e.jsx("button",{onClick:()=>w(l),disabled:y,className:"flex items-center px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition disabled:opacity-50",children:y?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-5 h-5 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-5 h-5 mr-2"}),"Save Changes"]})})})]})})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"System Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"App Version"}),e.jsx("p",{className:"text-base font-medium text-gray-900",children:"1.0.0-stable"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Environment"}),e.jsx("p",{className:"text-base font-medium text-gray-900",children:"Production"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Last System Update"}),e.jsx("p",{className:"text-base font-medium text-gray-900",children:new Date().toLocaleDateString()})]})]})]})]})})};export{I as default};
